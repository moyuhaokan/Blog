2.1 功能组织及重用



传统的代码组织方式是将包含大量代码的单个文件分解成多个文件。



node 是通过模块的方式来进行引用（requires）。引入的文件需要导出（exports）。这样子达到了代码复用的效果，也不会污染全局作用域。



2.2 新的 node 项目



在空文件夹下面运行 npm init -y 就会生成一个默认值的 package.json 文件。



2.3 module.exports 微调模块的创建



不能使用 exports 创建，因为 node 不允许对象，函数，变量给 exports 赋值。但是 module 可以。



2.4 用 node_modules 重用模块



使用 node_modules 目录可以不用具体的模块存放位置，直接引入。



2.5 如果在 package.json 里面有有 main 元素，也就是指定的项目入口，如果没有，就用 index.js 来作为入口



2.6 使用异步编程





回调通常是用来定义一次性响应的逻辑。



事件监听本质上也是一个回调，只不过是跟一个概念实体（事件）相关联。比如点击事件发生后，就产生了一个需要处理的事件，可以去监听事件，并做相应的处理。



2.7 回调



使用回调的两个参数，第一个是放可能会发生的错误，第二个用来放结果。



2.8 用事件发射器处理重复性事件



事件发射器会触发事件，并且在那些事件被触发时能处理它们。



2.9异步开发的难题



因为 node 中异步很多，所以程序执行有可能会有没有那么直观。



可以使用闭包来保存变量。



2.10 -2.14  流程控制





流程控制可以使用工具 async。







 3 node web 程序是什么



3.1 node web 程序的结构



package.json 一个包含依赖项列表和运营这个程序的命令的文体。



public 静态资源文件夹，CSS 和客户端JavaScript 都放在这里



node_modules 项目的依赖项都会装到这里



放程序 diam 的一个或多个 JavaScript 文件





程序代码的分块



app.js 或者 index.js 设置程序的代码

models 数据库模型；

views 用来渲染页面的模板

controllers 或 routes  http 请求处理器；

middleware 中间件组件





开始新的 web 程序



1.使用 npm init -fy  生成默认项目

2.npm install --save xxxx  安装你所需要的依赖



也可以使用 npm rm xxx --save 删除依赖







4.前端构建系统





4.1 基于 node 的前端开发



npm 既用于前端模块，比如 react，VUE，也用于后端，比如 koa,egg。还有比如 lodash通用库。



4.2  用 npm 运行脚本





node 有 npm,而 npm 能运行脚本。因此使用 npm start 或 npm test 来运行脚本。在package.json 有个 scripts 属性，可以在自定义 npm 命令。

npm run 命令等同于 npm run-script ,用 npm run script-name 可以运行任何脚本。





配置前端构建工具的方法。



1.指定命令行参数。比如 /node_modules/.bin/uglify --source-map



2.针对项目创建配置文件，将参数放在这个文件中。Babel 和 ESlint 经常这么干。

3.将配置参数添加到 package.json 中。





4.3gulp 看不懂，跳过了



4.4webpack 构建



webpack 的优势之一是更容易快速搭建出一个支持增量式构建的构建系统。

插件是用来改变构建过程的行为的。比如去掉输入中重复的文件。

加载器是用来转换资源文件的。比如将 sass 转换成 CSS，加载器是一个函数。



webpack 支持热重载，也就是说刷新浏览器就能看出代码变化。



5.服务端框架



5.1 用户画像

跳过



5.2 框架是什么



在 node 中，大部分框架都应该叫做模块。



loopBack 用了如下定义。





API 框架，HTTP 服务器库，HTTP 服务器框架，Web MVC 框架，全栈框架。





5.3

koa在生成器上有先发优势，但现在已经没有了，现在有的基本上就是精简，有很好的第三方插件,还有 中国很火的 egg 框架也是基于 koa 的。

5.4



Kraken 是基于 express 的框架，一个 MVC 框架，在 2020 年了，我第一次听说。

5.5

hapi 是个服务器框架，重点是 web API 的开发。没有客户端支持，也没有数据模型从哪个。有路由 API 和 HTTP 服务器封装。





5.6

Sails是一个模型-视图-控制器框架。看不出来那里好



5.7



DerbyJS可以用来做实时的数据可视化项目不错。

5.8

Flatiron是Web框架，有URL路由、数据管理、中间件、插件和日志功能。也可以使用单独的一个模块，比如说中间件。





5.9

LoopBack也是没咋听说过，看了一下官网，稳定版本是 webpack 3.

5.10 -  5.13

这些框架都不错，但是我选择 egg。不为什么，就是因为我公司用了 egg。哈哈哈哈哈哈



6.深入了解Connect和Express



6.1 connect



connect 以前是 express 的基础。



connect 中间件就是 JavaScript 函数，一般这个函数有三个参数： 请求对象，响应对象，以及一个名为 next 的回调函数。

connect 中的 use 方法就是用来组合中间件的。

connect 是 node 的一个中间件框架。



6.2



express 框架是在 connect 基础上搭建的。

基于环境的配置是指，根据 node 运行的环境，取其相应的配置。默认是开发环境。



7.Web 程序的模板



7.1

MVC 的主要思想是将逻辑，数据和展示层分离。



由控制器向模型请求数据，得到数据后传给视图，再由视图以特定格式呈现给用户。



可以使用模板引擎来内容更好的呈现。



7.2 EJS 模板引擎

EJS支持简单的流程控制，以及转义或非转义插值。

7.3 Muustache 



Mustache遵循极简主义，特意去掉了条件逻辑。

7.4 Pug



是 express 的默认模板引擎，很简洁，易于维护，可以输出HTML，但不用尖括号。



总结一下

模板引擎可以把程序逻辑和展示组织好。







8 存储数据



8.1 关系型数据库



用模式指定各种数据类型的格式和这些数据类型之间的关系。

关系型数据库可以支持复杂查询，用 SQL 语句方便的在一个表以及多个表之间做非常复杂的数据查询。



8.2 - 8.4 



比较了 MyQSL PostgreSQL 和 Knex的区别，我看完之后，我感觉如果是普通项目，用啥都行，可能 MYSQL 会更有名一点，社区更丰富，资料更全，实在不行还可以做数据迁移的工作。



8.5 ACID 保证





ACID 是对数据库事务的一组要求： 原子性，一致性，隔离性和耐用性。系统对 ACID 保证越严格，在性能上作出的让步就越大。



原子性： 无论成败，事务必须整体执行。

原子性事务不能被部分执行，或者是整个操作都完成了，或者数据库保持原样。有点类似于黑白分明，没有中间地段。



一致性： 始终确保约束条件



成功完成的事务必须符合系统中定义的所有数据完整性约束。比如主键必须唯一，数据哟啊符合某种特定的模式，或者外键必须执行存在的实体。

隔离性：并发事务不会互相干扰



不管是并发还是线性执行，隔离性事务的执行结果应该都是一样的。系统的隔离水平会直接影响它执行并发操作的能力。全局锁是一种比较低幼的隔离方式。由于在事务期间会把整个数据库锁住，所以只能串行处理事务。这是很强的隔离性保证，但效率也很低。



在现实情况中，一般会提供比较精细和更有选择性的锁模式。



耐用性： 事务是永久的



事务的耐用性是对持久化生效的保证，在重启，断电，系统错误甚至硬件失效的情况下，持久化的效果依然不受影响。



8.6 非关系模型的数据存储统称为 NoSQL。



NoSQL的范式及相应的数据库的例子：



键-值/元祖存储 ，图储存，文档存储，列存储，时间序列存储，多范式。



一般来说，NoSQL 数据默认就是非规范化的，甚至会跳过域建模。这样就不会在数据模型上做过多工作，修改起来会更迅速，并形成更简单，更好执行的设计。







8.7 分布式数据库





程序可以在垂直和水平两个方向上扩展，垂直扩展是指增加机器的能力，水平扩展是指增加机器的数量。



分布式数据库从一开始就是按照水平扩展设计的。





8.8 MongoDB



MongoDB 是面向对象的分布式数据库，把文档存储在无模式的数据集中，不需要预先为文档定义模式，同一个数据集中的文档也不用遵循相同的模式。



8.9 键/值存储



键/值存储中的所有记录都是由一个键值对构成的。大多数键值系统都不对值的数据类型，长度和结构做限制。在键/值数据库看了，值是不透明的原子： 数据库不知道，或者说不关心值的数据类型，并且将值作为一个整体，不会切分或访问其中部分数据。





8.10 Redis



Redis 是热门的结构化内存数据库。主要是用来存储 缓存的用的数据和用来高速读/写。

8.11 嵌入式数据库



使用嵌入式数据库时不需要安装或管理一个外部服务器。

它是嵌入在程序里运行的，程序一般通过直接的过程调用跟嵌入式数据库通信，不需要通过进程间通信通道。



8.12 LevelDB



LevelDB是Google在2011年初开发的嵌入式持久化键/值存储，最开始是要给Chrome里实现的IndexedDB做后台存储的。



8.13 昂贵的序列化和反序列化



JSON 操作是昂贵的阻塞式操作。在进程将数据装进 JSON，或从 JSON 取出数据时，做不了别的事情，也就是说是一个同步操作





8.14 浏览器存储



前端浏览器上面的 localStorage和sessionStorage， 不说了，前端人都懂的。





8.15 存储托管



使用存储托管不需要管理自己的服务器端存储。像Amazon Web服务（AWS）这样的厂商提供的那些托管式基础设施一般仅作为扩展和性能优化方案，但在早期巧用这些托管式服务可以免于实现不必要的基础设施，从而节省大量时间。



国内有个阿里云，腾讯云，华为云等。





9 .测试 Node 程序

单元测试直接测试代码逻辑，通常是在函数或方法层面，适用于所有类型的程序。有 测试驱动开发（TDD）和行为驱动开发（BDD）

验收测试一遍是对 Web 程序进行额外的测试，需用用脚本控制浏览器来触发 Web 程序的功能。

9.1 单元测试



assert 模块是 Node 中大多数单元测试的基础，可以测试一个条件，如果条件未满足，则抛出错误。



常用的测试框架有，jest，Chai,Should.js,MOcha。我简单用过 jest，感觉还可以。



9.2 功能测试



功能测试是 按用户指定的需求列表驱动浏览器执行操作，然后检查各种 DOM 变化。







9.3 处理失败的测试



当我们测试失败时，可以一些工具，生成详细的日志，方便以后调试。





10 Node 程序的部署及运维



10.1 安置 Node 程序



有三种可靠且可扩展的方式运行 Node 程序： 

平台即服务——在 Amazon，Azure或 Herku 上运行；

服务器或虚拟主机——在云上，私有主机公司或你们公司内部的服务器上，



容器——用 DOcker 这样子的软件容器运行你的程序和其他相关的服务。



10.2部署的基础知识



用 Git 库部署的基本步骤



1.用 SSH 链接到服务器。

2.如果需要的话，在服务器上安装 Node 和版本控制工具

3.从版本库中将程序文件，包括 Node 脚本,图片，CSS 样式表等，下载到服务器上。

4.启动服务。



10.3 在线时长和性能的最大化



说实话，看不懂这个小节。







11编写命令行程序



看不懂



12 用 Electron 征服桌面



在Electron上，可以用Node、JavaScript、HTML和CSS做桌面程序。



但是原始包比较大。

